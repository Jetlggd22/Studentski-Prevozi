<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Študentski Prevozi - Ustvari Novo Relacijo</title>
  <link rel="stylesheet" href="Styles/Style.css"> <!-- Make sure this path is correct -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link rel="icon" href="img/sp_favicon.png" type="image/x-icon"> <!-- Make sure this path is correct -->
  <style>
    /* Basic styling for multi-step form - can be expanded in Style.css */
    body {
      font-family: 'Montserrat', sans-serif; /* Ensure font is loaded */
    }
    .multi-step-form-container {
      max-width: 600px;
      margin: 40px auto;
      background: var(--dark-light, #1a1a1a); /* Fallback color */
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,215,0,0.1);
    }

    .form-step {
      display: none; /* Hidden by default */
      animation: fadeIn 0.5s;
    }

    .form-step.active {
      display: block;
    }

    .progress-bar-container {
      width: 100%;
      background-color: var(--dark-medium, #222222); /* Fallback color */
      border-radius: 10px;
      margin-bottom: 30px;
      border: 1px solid rgba(255,215,0,0.2);
    }

    .progress-bar {
      width: 0%; /* Initial width */
      height: 15px;
      background-color: var(--gold, #ffd700); /* Fallback color */
      border-radius: 10px;
      text-align: center;
      line-height: 15px; /* For text if any */
      color: var(--dark, #111111); /* Fallback color */
      font-weight: bold;
      transition: width 0.4s ease;
    }

    .form-step h2 {
      color: var(--gold, #ffd700); /* Fallback color */
      margin-bottom: 20px;
      text-align: center;
    }

    .form-step label {
      display: block;
      color: rgba(255,255,255,0.8);
      margin-bottom: 8px;
      font-weight: 600;
    }

    .form-step input[type="text"],
    .form-step input[type="number"],
    .form-step input[type="datetime-local"],
    .form-step select,
    .form-step textarea {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 20px;
      background: var(--dark-medium, #222222); /* Fallback color */
      border: 1px solid rgba(255,215,0,0.3);
      border-radius: 8px;
      color: var(--white, #ffffff); /* Fallback color */
      font-size: 1rem;
      box-sizing: border-box; /* Ensure padding doesn't make it overflow */
    }
     .form-step input[type="text"]:focus,
    .form-step input[type="number"]:focus,
    .form-step input[type="datetime-local"]:focus,
    .form-step select:focus,
    .form-step textarea:focus {
        border-color: var(--gold, #ffd700); /* Fallback color */
        outline: none;
        box-shadow: 0 0 0 2px rgba(255,215,0,0.2);
    }


    .location-suggestions {
      list-style: none;
      padding: 0;
      margin: -15px 0 15px 0;
      border: 1px solid rgba(255,215,0,0.3);
      border-top: none;
      border-radius: 0 0 8px 8px;
      background-color: var(--dark-medium, #222222); /* Fallback color */
      max-height: 150px;
      overflow-y: auto;
      position: absolute; /* To overlay other content */
      width: calc(100% - 2px); /* Match input width considering border */
      z-index: 10;
      box-sizing: border-box;
    }
    .location-suggestions li {
      padding: 10px 15px;
      color: var(--white, #ffffff); /* Fallback color */
      cursor: pointer;
    }
    .location-suggestions li:hover {
      background-color: rgba(255,215,0,0.1);
    }
    .input-container { /* Added for positioning suggestions */
        position: relative;
    }


    .form-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    .form-navigation button {
      background: var(--gold, #ffd700); /* Fallback color */
      color: var(--dark, #111111); /* Fallback color */
      border: none;
      padding: 10px 25px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
    }
    .form-navigation button:hover {
      background: #e6c300; /* Darker gold */
      transform: translateY(-2px);
    }
    .form-navigation button.prev-btn {
      background-color: var(--dark-medium, #222222); /* Fallback color */
      color: var(--gold, #ffd700); /* Fallback color */
      border: 1px solid var(--gold, #ffd700); /* Fallback color */
    }
     .form-navigation button.prev-btn:hover {
      background-color: rgba(255,215,0,0.1);
    }
     .form-navigation button:disabled {
        background-color: #555;
        color: #aaa;
        cursor: not-allowed;
        border-color: #555;
    }


    #ponavljanjeOptions {
        display: none; /* Hidden by default */
        margin-top: 10px;
        padding: 15px;
        background-color: rgba(255,215,0,0.05);
        border-radius: 8px;
        border: 1px solid rgba(255,215,0,0.1);
    }
     #ponavljanjeOptions label {
        margin-right: 15px;
        font-weight: normal;
        color: rgba(255,255,255,0.7);
     }
      #ponavljanjeOptions input[type="checkbox"],
      #ponavljanjeOptions input[type="radio"] {
        margin-right: 5px;
        accent-color: var(--gold, #ffd700); /* Fallback color */
      }
      #dneviVTednuContainer label {
        display: inline-block;
        margin-right: 10px;
      }

    .error-message-form {
        color: #f44336; /* Red color for errors */
        background-color: rgba(244, 67, 54, 0.1);
        border: 1px solid #f44336;
        padding: 10px;
        border-radius: 8px;
        margin-top: 20px;
        text-align: center;
        display: none; /* Hidden by default */
    }


    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px);}
      to { opacity: 1; transform: translateY(0);}
    }
  </style>
</head>
<body>
  <div class="loader" id="loader">
    <div class="loader-content">
      <div class="loader-spinner"></div>
      <div class="loader-logo">Študentski Prevozi</div>
    </div>
  </div>

  <header class="header" id="header">
    <div class="container header-container">
      <a href="Index.html" class="logo">
        <i class="ri-focus-3-line logo-icon"></i>
        <span class="logo-text">Študentski Prevozi</span>
      </a>
      <ul class="nav-menu" id="nav-menu">
        <li class="nav-item"><a href="Index.html" class="nav-link"><i class="ri-home-4-line nav-icon"></i> Domov</a></li>
        <li class="nav-item"><a href="Relacije.html" class="nav-link"><i class="ri-map-pin-line nav-icon"></i> Relacije</a></li>
        <li class="nav-item"><a href="Vozniki.html" class="nav-link"><i class="ri-award-line nav-icon"></i> Vozniki</a></li>
        <li class="nav-item"><a href="ONas.html" class="nav-link"><i class="ri-customer-service-2-line nav-icon"></i> O Nas</a></li>
        <li class="nav-item"><a href="Login.html" class="nav-link" id="login_profil_link"><i class="ri-login-circle-line nav-icon"></i> Prijava</a></li>
      </ul>
      <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
    </div>
  </header>
  <div class="overlay" id="overlay"></div>

  <section class="profile-hero">
    <div class="container">
      <div class="profile-hero-content">
        <h1>Ustvari Novo Relacijo</h1>
        <p>Vnesite podatke o vaši novi študentski vožnji.</p>
      </div>
    </div>
  </section>

  <main class="profile-main">
    <div class="container">
      <div class="multi-step-form-container">
        <div class="progress-bar-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>

        <form id="createRideForm">
          <!-- Step 1: Destination -->
          <div class="form-step active" id="step1">
            <h2>Korak 1: Kam želiš iti?</h2>
            <label for="toLocation">Ciljna lokacija:</label>
            <div class="input-container">
                <input type="text" id="toLocation" name="toLocation" placeholder="Npr. Fakulteta za računalništvo" required>
                <ul class="location-suggestions" id="toLocationSuggestions"></ul>
            </div>
            <input type="hidden" id="toLocationLongitude" name="toLocationLongitude">
            <input type="hidden" id="toLocationLatitude" name="toLocationLatitude">
            <div class="form-navigation">
              <button type="button" class="next-btn">Naprej <i class="ri-arrow-right-line"></i></button>
            </div>
          </div>

          <!-- Step 2: Starting Point -->
          <div class="form-step" id="step2">
            <h2>Korak 2: Od kod potuješ?</h2>
            <label for="fromLocation">Odhodna lokacija:</label>
            <div class="input-container">
                <input type="text" id="fromLocation" name="fromLocation" placeholder="Npr. Dijaški dom Tabor, Maribor" required>
                <ul class="location-suggestions" id="fromLocationSuggestions"></ul>
            </div>
            <input type="hidden" id="fromLocationLongitude" name="fromLocationLongitude">
            <input type="hidden" id="fromLocationLatitude" name="fromLocationLatitude">
            <div class="form-navigation">
              <button type="button" class="prev-btn"><i class="ri-arrow-left-line"></i> Nazaj</button>
              <button type="button" class="next-btn">Naprej <i class="ri-arrow-right-line"></i></button>
            </div>
          </div>

          <!-- Step 3: Passengers -->
          <div class="form-step" id="step3">
            <h2>Korak 3: Število potnikov?</h2>
            <label for="seats">Število prostih mest (razen vas):</label>
            <select id="seats" name="seats" required>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3" selected>3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
            </select>
            <div class="form-navigation">
              <button type="button" class="prev-btn"><i class="ri-arrow-left-line"></i> Nazaj</button>
              <button type="button" class="next-btn">Naprej <i class="ri-arrow-right-line"></i></button>
            </div>
          </div>

          <!-- Step 4: Travel Time -->
          <div class="form-step" id="step4">
            <h2>Korak 4: Kdaj potuješ?</h2>
            <label for="departureTime">Datum in ura odhoda:</label>
            <input type="datetime-local" id="departureTime" name="departureTime" required>
            
            <label for="isRecurring" style="margin-top: 15px; display:inline-flex; align-items:center;">
                <input type="checkbox" id="isRecurring" name="isRecurring" style="width:auto; margin-right:10px;"> Ponavljajoča se vožnja?
            </label>

            <div id="ponavljanjeOptions">
                <label>Tip ponavljanja:</label><br>
                <input type="radio" id="ponavljanjeDnevno" name="tipPonavljanja" value="dnevno"> <label for="ponavljanjeDnevno">Vsak dan</label>
                <input type="radio" id="ponavljanjeTedensko" name="tipPonavljanja" value="tedensko"> <label for="ponavljanjeTedensko">Tedensko</label>
                <input type="radio" id="ponavljanjeMesecno" name="tipPonavljanja" value="mesecno"> <label for="ponavljanjeMesecno">Na določen dan v mesecu (npr. vsak 15.)</label>
                <br><br>
                 <div id="dneviVTednuContainer" style="display:none; margin-top:10px;">
                    <label>Izberi dneve v tednu:</label><br>
                    <input type="checkbox" name="dneviTedna" value="pon"> PON
                    <input type="checkbox" name="dneviTedna" value="tor"> TOR
                    <input type="checkbox" name="dneviTedna" value="sre"> SRE
                    <input type="checkbox" name="dneviTedna" value="cet"> ČET
                    <input type="checkbox" name="dneviTedna" value="pet"> PET
                    <input type="checkbox" name="dneviTedna" value="sob"> SOB
                    <input type="checkbox" name="dneviTedna" value="ned"> NED
                </div>
            </div>

            <div class="form-navigation">
              <button type="button" class="prev-btn"><i class="ri-arrow-left-line"></i> Nazaj</button>
              <button type="button" class="next-btn">Naprej <i class="ri-arrow-right-line"></i></button>
            </div>
          </div>

          <!-- Step 5: Price & Details -->
          <div class="form-step" id="step5">
            <h2>Korak 5: Cena in dodatne informacije</h2>
            <label for="price">Cena na potnika (€):</label>
            <input type="number" id="price" name="price" min="0" step="0.50" placeholder="Npr. 5.50" required>
            
            <label for="car">Avto (znamka/model):</label>
            <input type="text" id="car" name="car" placeholder="Npr. VW Golf TDI">

            <label for="note">Opombe (neobvezno):</label>
            <textarea id="note" name="note" rows="3" placeholder="Npr. Pobiram tudi na glavni postaji, samo za nekadilce..."></textarea>
            <div class="form-navigation">
              <button type="button" class="prev-btn"><i class="ri-arrow-left-line"></i> Nazaj</button>
              <button type="submit" class="submit-btn">Objavi Relacijo <i class="ri-send-plane-line"></i></button>
            </div>
          </div>
        </form>
        <div id="formErrorMessage" class="error-message-form"></div>
      </div>
    </div>
  </main>

  <footer class="footer" id="contact">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-col footer-about">
          <a href="Index.html" class="logo">
            <i class="ri-focus-3-line logo-icon"></i><span class="logo-text">Študentski Prevozi</span>
          </a>
          <p>Povezujemo študente za lažja, cenejša in bolj trajnostna potovanja.</p>
        </div>
        <div class="footer-col footer-links">
          <h4>Hitre Povezave</h4>
          <ul>
            <li><a href="Relacije.html"><i class="ri-arrow-right-s-line"></i> Iskanje Relacij</a></li>
            <li><a href="Vozniki.html"><i class="ri-arrow-right-s-line"></i> Vozniki</a></li>
            <li><a href="FAQ.html"><i class="ri-arrow-right-s-line"></i> Pogosta Vprašanja</a></li>
          </ul>
        </div>
        <div class="footer-col footer-links">
          <h4>Podpora</h4>
          <ul>
            <li><a href="Kontakt.html"><i class="ri-arrow-right-s-line"></i> Kontakt</a></li>
            <li><a href="PolitikaZasebnosti.html"><i class="ri-arrow-right-s-line"></i> Politika Zasebnosti</a></li>
            <li><a href="PogojiUporabe.html"><i class="ri-arrow-right-s-line"></i> Pogoji Uporabe</a></li>
          </ul>
        </div>
        <div class="footer-col footer-subscribe">
          <h4>Naročilo na Novice</h4>
          <form>
            <input type="email" placeholder="Vaš E-naslov">
            <button type="submit"><i class="ri-send-plane-line"></i></button>
          </form>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Študentski Prevozi. Vse pravice pridržane.</p>
      </div>
    </div>
  </footer>

  <div class="back-to-top" id="back-to-top"><i class="ri-arrow-up-line"></i></div>

  <!-- SCRIPT FOR ustvariRelacijo.js IS COMMENTED OUT FOR TESTING THE LOADER -->
  <script src="script/ustvariRelacijo.js" defer></script>
  
  <script>
    // General page scripts (loader, nav, etc.)
    window.addEventListener('load', () => {
      console.log("Window load event fired for UstvariRelacijo.html");
      setTimeout(() => {
        const loader = document.getElementById('loader');
        if (loader) {
            console.log("Loader element found, attempting to hide.");
            loader.style.opacity = '0';
            setTimeout(() => {
                if (loader) loader.style.display = 'none';
                console.log("Loader display set to none.");
            }, 500);
        } else {
            console.error("Loader element #loader NOT found on UstvariRelacijo.html!");
        }
      }, 100); // Reduced timeout for faster testing
    });

    const hamburger = document.getElementById('hamburger');
    const navMenu = document.getElementById('nav-menu');
    const overlay = document.getElementById('overlay');
    const navLinks = document.querySelectorAll('.nav-link');

    if (hamburger && navMenu && overlay) { // Added checks for element existence
        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
            overlay.classList.toggle('active');
            document.body.style.overflow = navMenu.classList.contains('active') ? 'hidden' : 'auto';
        });
        overlay.addEventListener('click', () => {
            hamburger.classList.remove('active');
            navMenu.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        });
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (navMenu.classList.contains('active')) { // Only if menu is open
                    hamburger.classList.remove('active');
                    navMenu.classList.remove('active');
                    overlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });
        });
    } else {
        console.warn("Hamburger, navMenu, or overlay element not found. Nav will not be fully functional.");
    }

    const header = document.getElementById('header');
    if(header) {
        window.addEventListener('scroll', () => {
            header.classList.toggle('scrolled', window.scrollY > 50);
        });
    }

    const backToTop = document.getElementById('back-to-top');
    if(backToTop) {
        window.addEventListener('scroll', () => {
            backToTop.classList.toggle('show', window.scrollY > 300);
        });
        backToTop.addEventListener('click', () => window.scrollTo({top: 0, behavior: 'smooth'}));
    }

    window.addEventListener('DOMContentLoaded', function() {
        console.log("DOMContentLoaded event fired for UstvariRelacijo.html");
        if (sessionStorage.getItem('user')) {
            var loginLink = document.getElementById('login_profil_link');
            if (loginLink) {
                loginLink.innerHTML = '<i class="ri-user-line nav-icon"></i> Profil';
                loginLink.href = 'Profil.html';
            } else {
                console.warn("Element with ID 'login_profil_link' not found.");
            }
        }
    });
  </script>
</body>
</html>
