<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Študentski Prevozi - Uredi Profil</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="Styles/Style.css">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link rel="icon" href="img/sp_favicon.png" type="image/x-icon">
</head>
<style>
 
  .form-container {
    background-color: #1e1e1e;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 4px 12px rgba(255, 215, 0, 0.15);
    max-width: 950px;
    margin: auto;
  }

  .form-section {
    margin-bottom: 2.5rem;
  }

  .form-section h2 {
    color: gold;
    font-weight: 600;
    font-size: 1.5rem;
  }

  .form-label {
    color: #f1f1f1;
    font-weight: 500;
    margin-bottom: 6px;
    font-size: 0.95rem;
  }

  /* Modern, spaced input styles */
  .form-control,
  .form-select {
    background: black;
    color: #fff;
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 14px;
    padding: 14px 18px;
    transition: all 0.3s ease-in-out;
    box-shadow: inset 0 0 6px rgba(255, 215, 0, 0.05);
    font-size: 1rem;
    margin-bottom: 1rem;
    width: 100%;
  }

  .form-control::placeholder {
    color: #ccc;
    opacity: 0.6;
  }


  .form-select:focus {
    background: black;
    border-color: gold;
    box-shadow: 0 0 0 0.25rem rgba(255, 215, 0, 0.25);
    color: #fff;
  }


  .form-select option {
    background-color: black;
    color: #fff;
  }

  .btn-gold {
    background-color: gold;
    color: #000;
    font-weight: 600;
    padding: 12px 34px;
    border: none;
    border-radius: 12px;
    transition: all 0.3s ease;
    font-size: 1rem;
  }

  .btn-gold:hover {
    background-color: #d4af37;
    color: #fff;
    transform: translateY(-2px); }

  .read-only-field {
    padding: 14px 18px;
    background-color: #2c2c2c;
    border-radius: 12px;
    color: #ccc;
    border: 1px solid rgba(255, 215, 0, 0.1);

  }
  </style>
<body>
  <!-- Loader -->
  <div class="loader" id="loader">
    <div class="loader-content">
      <div class="loader-spinner"></div>
      <div class="loader-logo">Študentski Prevozi</div>
    </div>
  </div>

  <!-- Header -->
  <header class="header" id="header">
    <div class="container header-container">
      <a href="#" class="logo">
        <i class="ri-focus-3-line logo-icon"></i>
        <span class="logo-text">Študentski Prevozi</span>
      </a>
      <ul class="nav-menu" id="nav-menu">
        <li class="nav-item"><a href="Index.html" class="nav-link"><i class="ri-home-4-line nav-icon"></i> Domov</a></li>
        <li class="nav-item"><a href="Relacije.html" class="nav-link"><i class="ri-map-pin-line nav-icon"></i> Relacije</a></li>
        <li class="nav-item"><a href="Vozniki.html" class="nav-link"><i class="ri-award-line nav-icon"></i> Vozniki</a></li>
       
        <li class="nav-item"><a href="ONas.html" class="nav-link"><i class="ri-customer-service-2-line nav-icon"></i> O Nas</a></li>
      </ul>
      <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div class="overlay" id="overlay"></div>

  <!-- Edit Profile Hero Section -->
  <section class="profile-hero">
    <div class="container">
      <div class="profile-hero-content">
        <h1>Uredi Profil</h1>
        <p>Posodobite svoje osebne podatke in nastavitve računa</p>
      </div>
    </div>
  </section>

  <!-- Edit Profile Main Section -->
  <section class="profile-main">
    <div class="container">
      <div class="profile-layout">
        <!-- Profile Sidebar -->
        <aside class="profile-sidebar">
          <div class="profile-card">
            <div class="profile-avatar">
              <div class="avatar-wrapper">
                <img src="img/" alt="Profilna slika" class="avatar-image" id="profile-image">
                <label class="avatar-edit" title="Spremeni sliko">
                  <i class="ri-camera-line"></i>
                  <input type="file" id="avatar-upload" accept="image/*" style="display:none;">
                </label>
              </div>
              <div class="profile-meta">
  <h3 class="profile-name" id="sidebar-imepriimek">Janez Novak</h3>
  <p class="profile-email"><i class="ri-mail-line"></i> <span id="sidebar-email">janez.novak@student.uni-lj.si</span></p>
  
            </div>
            
            <div class="profile-stats">
              <div class="stat-item">
                <div class="stat-value">24</div>
                <div class="stat-label">Voženj</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">4.9</div>
                <div class="stat-label">Ocena</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">3</div>
                <div class="stat-label">Sopotniki</div>
              </div>
            </div>
            
            <nav class="profile-menu">
              <a href="Profil.html" class="menu-item">
                <i class="ri-user-line"></i>
                <span>Osebni podatki</span>
              </a>
              <a href="#" class="menu-item">
                <i class="ri-history-line"></i>
                <span>Zgodovina voženj</span>
              </a>
            </nav>
            
            <div class="profile-actions">
              <a href="Profil.html" class="btn btn-outline"><i class="ri-arrow-left-line"></i> Nazaj na profil</a>
              <a href="Login.html" class="btn btn-logout"><i class="ri-logout-box-r-line"></i> Odjava</a>
            </div>
          </div>
        </aside>
        
        <!-- Edit Profile Content -->
       <main class="container py-5">
  <form id="editForm" class="form-container">
    <!-- Personal Info Section -->
    <section class="form-section">
      <div class="section-header">
        <h2><i class="ri-user-line me-2"></i>Osebni podatki</h2>
      </div>

      <div class="row g-3">
        <div class="col-md-6">
          <label for="first-name" class="form-label">Ime</label>
          <input type="text" id="first-name" class="form-control" required>
        </div>
        <div class="col-md-6">
          <label for="last-name" class="form-label">Priimek</label>
          <input type="text" id="last-name" class="form-control"  required>
        </div>
        <div class="col-md-6">
          <label for="email" class="form-label">E-naslov</label>
          <input type="email" id="email" class="form-control"  required>
        </div>
        <div class="col-md-6">
          <label for="phone" class="form-label">Telefon</label>
          <input type="tel" id="phone" class="form-control"  required>
        </div>
        
        <div class="col-md-6">
          <label class="form-label">Član od</label>
          <p class="read-only-field">marec 2024</p>
        </div>
      </div>
    </section>

    <!-- Password Section -->
    <section class="form-section">
      <div class="section-header">
        <h2><i class="ri-lock-line me-2"></i>Sprememba gesla</h2>
      </div>

      <div class="row g-3">
        <div class="col-md-4">
          <label for="current-password" class="form-label">Trenutno geslo</label>
          <input type="password" id="current-password" class="form-control">
        </div>
        <div class="col-md-4">
          <label for="new-password" class="form-label">Novo geslo</label>
          <input type="password" id="new-password" class="form-control">
        </div>
        <div class="col-md-4">
          <label for="confirm-password" class="form-label">Potrdi novo geslo</label>
          <input type="password" id="confirm-password" class="form-control">
        </div>
      </div>
    </section>

    <div class="text-end mt-4">
      <button type="submit" class="btn btn-gold">Shrani spremembe</button>
    </div>
  </form>
</main>

  </section>

  <footer class="footer" id="contact">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-col footer-about">
          <a href="#" class="logo">
            <i class="ri-focus-3-line logo-icon"></i>
            <span class="logo-text">Študentski Prevozi</span>
          </a>
          <p>Študentski Prevozi je vodilna študentska potovalna agencija, ki združuje luksuzna doživetja z ugodnimi cenami za nepozabne dogodivščine sodobnih raziskovalcev.</p>
          <div class="footer-social">
            <a href="#" class="social-link"><i class="ri-instagram-line"></i></a>
            <a href="#" class="social-link"><i class="ri-twitter-x-line"></i></a>
            <a href="#" class="social-link"><i class="ri-facebook-circle-line"></i></a>
            <a href="#" class="social-link"><i class="ri-linkedin-box-line"></i></a>
          </div>
        </div>

        <div class="footer-col footer-links">
          <h4>Podjetje</h4>
          <ul>
            <li><a href="Kontakt.html"><i class="ri-arrow-right-s-line"></i> Kontaktiraj nas</a></li>
            <li><a href="NasaEkipa.html"><i class="ri-arrow-right-s-line"></i> Naša ekipa</a></li>
            <li><a href="Blog.html"><i class="ri-arrow-right-s-line"></i> Blog</a></li>
          </ul>
        </div>

        <div class="footer-col footer-links">
          <h4>Podpora</h4>
          <ul>
            <li><a href="FAQ.html"><i class="ri-arrow-right-s-line"></i> Pogosta vprašanja</a></li>
            <li><a href="PolitikaZasebnosti.html"><i class="ri-arrow-right-s-line"></i> Politika zasebnosti</a></li>
            <li><a href="PogojiUporabe.html"><i class="ri-arrow-right-s-line"></i> Pogoji uporabe</a></li>
          </ul>
        </div>

        <div class="footer-col footer-subscribe">
          <h4>Naroči se</h4>
          <p>Naroči se na naš novičnik in bodi obveščen o novih destinacijah ter ekskluzivnih ponudbah.</p>
          <form>
            <input type="email" placeholder="Vnesi svoj e-naslov">
            <button type="submit"><i class="ri-send-plane-line"></i></button>
          </form>
        </div>
      </div>
    </div>
  </footer>

  <div class="back-to-top" id="back-to-top">
    <i class="ri-arrow-up-line"></i>
  </div>

   <div id="errorModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h2>Napaka pri prijavi</h2>
    <p id="modalMessage"></p>
  </div>
</div>

</body>
  <!-- Scripts -->
  <script>
    // Loader
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('loader').style.opacity = '0';
        setTimeout(() => {
          document.getElementById('loader').style.display = 'none';
        }, 500);
      }, 1000);
    });

    // Mobile Navigation
    const hamburger = document.getElementById('hamburger');
    const navMenu = document.getElementById('nav-menu');
    const overlay = document.getElementById('overlay');
    const navLinks = document.querySelectorAll('.nav-link');

    hamburger.addEventListener('click', () => {
      hamburger.classList.toggle('active');
      navMenu.classList.toggle('active');
      overlay.classList.toggle('active');
      document.body.style.overflow = navMenu.classList.contains('active') ? 'hidden' : 'auto';
    });

    overlay.addEventListener('click', () => {
      hamburger.classList.remove('active');
      navMenu.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = 'auto';
    });

    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        hamburger.classList.remove('active');
        navMenu.classList.remove('active');
        overlay.classList.remove('active');
        document.body.style.overflow = 'auto';
      });
    });

    // Header scroll effect
    const header = document.getElementById('header');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    });

    // Profile image upload
    const avatarUpload = document.getElementById('avatar-upload');
    const profileImage = document.getElementById('profile-image');
    
    avatarUpload.addEventListener('change', function(e) {
      if (e.target.files.length) {
        const src = URL.createObjectURL(e.target.files[0]);
        profileImage.src = src;
      }
    });

   

    // Back to top button
    const backToTop = document.getElementById('back-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        backToTop.classList.add('show');
      } else {
        backToTop.classList.remove('show');
      }
    });
    
    backToTop.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
    

   function showModal(message, isSuccess = false) {
  const modal = document.getElementById('errorModal');
  const msg = document.getElementById('modalMessage');
  msg.textContent = message;
  modal.querySelector('h2').textContent = isSuccess ? 'Uspeh' : 'Napaka pri prijavi';
  modal.style.display = 'flex';
  // On success, redirect after closing
  if (isSuccess) {
    document.getElementById('closeModal').onclick = function() {
      modal.style.display = 'none';
      window.location.href = 'Profil.html';
    };
  } else {
    document.getElementById('closeModal').onclick = function() {
      modal.style.display = 'none';
    };
  }
  // Optional: close modal on outside click
  window.onclick = function(event) {
    if (event.target === modal) {
      modal.style.display = 'none';
      if (isSuccess) window.location.href = 'Profil.html';
    }
  };
}
//フォームデータの編集
document.getElementById('editForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  let user = sessionStorage.getItem('user');
  if (!user) return;
  try {
    user = JSON.parse(user);
  } catch {
    showModal('Napaka pri branju uporabnika.');
    return;
  }
  if (user.data) user = user.data;

  const userId = user.idUporabnik;
  if (!userId) {
    showModal('Uporabniški ID ni najden.');
    return;
  }

  const newPassword = document.getElementById('new-password').value
  const confirmPassword = document.getElementById('confirm-password').value

  if(newPassword != confirmPassword) {
    showModal('Gesli se ne ujemata')
    return
  }

  const updatedData = {
    Ime: document.getElementById('first-name').value,
    Priimek: document.getElementById('last-name').value,
    Email: document.getElementById('email').value,
    Telefon: document.getElementById('phone').value,
    oldEmail: user.email,
    oldPassword: document.getElementById('current-password').value || '',
    newPassword: newPassword
  };

  try {
    const res = await fetch(`http://localhost:3000/api/uporabnik/${userId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(updatedData)
    });
    const result = await res.json();
    if (result.success) {
      sessionStorage.setItem('user', JSON.stringify({ success: true, data: { ...user, ...updatedData } }));
      showModal('Spremembe so bile uspešno shranjene!', true);
    } else {
      showModal('Napaka pri shranjevanju: ' + (result.message || ''));
    }
  } catch (err) {
    showModal('Napaka pri povezavi s strežnikom.');
  }

  
});

document.addEventListener('DOMContentLoaded', function() {
  let user = sessionStorage.getItem('user');
  if (!user) return;
  try {
    user = JSON.parse(user);
  } catch {
    return;
  }
  if (user.data) user = user.data;

  // Popuni sidebar
  const sidebarIme = document.getElementById('sidebar-imepriimek');
  const sidebarEmail = document.getElementById('sidebar-email');
  if (sidebarIme) sidebarIme.textContent = (user.Ime || '') + ' ' + (user.Priimek || '');
  if (sidebarEmail) sidebarEmail.textContent = user.email || user.Eposta || user.Username || '';

  // Popuni formu
  const ime = document.getElementById('first-name');
  const priimek = document.getElementById('last-name');
  const email = document.getElementById('email');
  const telefon = document.getElementById('phone');
  if (ime) ime.value = user.Ime || '';
  if (priimek) priimek.value = user.Priimek || '';
  if (email) email.value = user.email || user.Eposta || user.Username || '';
  if (telefon) telefon.value = user.Telefon || '';
});

  </script>
</body>
</html>
