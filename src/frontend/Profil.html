<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Študentski Prevozi - Profil</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" href="Styles/Style.css">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link rel="icon" href="img/sp_favicon.png" type="image/x-icon">
</head>
<body>
  <!-- Loader -->
  <div class="loader" id="loader">
    <div class="loader-content">
      <div class="loader-spinner"></div>
      <div class="loader-logo">Študentski Prevozi</div>
    </div>
  </div>

  <!-- Header -->
  <header class="header" id="header">
    <div class="container header-container">
      <a href="#" class="logo">
        <i class="ri-focus-3-line logo-icon"></i>
        <span class="logo-text">Študentski Prevozi</span>
      </a>
      <ul class="nav-menu" id="nav-menu">
        <li class="nav-item"><a href="Index.html" class="nav-link"><i class="ri-home-4-line nav-icon"></i> Domov</a></li>
        <li class="nav-item"><a href="Relacije.html" class="nav-link"><i class="ri-map-pin-line nav-icon"></i> Relacije</a></li>
        <li class="nav-item"><a href="Vozniki.html" class="nav-link"><i class="ri-award-line nav-icon"></i> Vozniki</a></li>
        
        <li class="nav-item"><a href="ONas.html" class="nav-link"><i class="ri-customer-service-2-line nav-icon"></i> O Nas</a></li>
      
      </ul>
      <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </header>
  <div class="overlay" id="overlay"></div>

  <!-- Profile Hero Section -->
  <section class="profile-hero">
    <div class="container">
      <div class="profile-hero-content">
       
        <h1>Moj Profil</h1>
        <p>Upravljajte svoje podatke, zgodovino voženj in nastavitve računa</p>
      </div>
    </div>
  </section>

  <!-- Profile Main Section -->
  <section class="profile-main">
    <div class="container">
      <div class="profile-layout">
        <!-- Profile Sidebar -->
        <aside class="profile-sidebar">
          <div class="profile-card">
            <div class="profile-avatar">
              <div class="avatar-wrapper">
                <img src="" alt="Profilna slika" class="avatar-image">
                <label class="avatar-edit" title="Spremeni sliko">
                  <i class="ri-camera-line"></i>
                  <input type="file" accept="image/*" style="display:none;">
                </label>
              </div>
              <div class="profile-meta">
  <h3 class="profile-name" id="sidebar-imepriimek">Janez Novak</h3>
  <p class="profile-email"><i class="ri-mail-line"></i> <span id="sidebar-email">janez.novak@student.uni-lj.si</span></p>
  
</div>
            </div>
            
            <div class="profile-stats">
              <div class="stat-item">
                <div class="stat-value">24</div>
                <div class="stat-label">Voženj</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">4.9</div>
                <div class="stat-label">Ocena</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">3</div>
                <div class="stat-label">Sopotniki</div>
              </div>
            </div>
            
            <nav class="profile-menu">
              <a href="#" class="menu-item active">
                <i class="ri-user-line"></i>
                <span>Osebni podatki</span>
              </a>
              <a href="Zgodovina.html" class="menu-item">
                <i class="ri-history-line"></i>
                <span>Zgodovina voženj</span>
              </a>
              
            </nav>
            
            <div class="profile-actions">
              <a href="UrediProfil.html" class="btn btn-outline"><i class="ri-edit-line"></i> Uredi profil</a>
              <a href="Login.html" class="btn btn-logout"><i class="ri-logout-box-r-line"></i> Odjava</a>
            </div>
          </div>
        </aside>
        
        <!-- Profile Content -->
        <main class="profile-content">
          <!-- Personal Info Section -->
          <section class="profile-section">
            <div class="section-header">
              <h2><i class="ri-user-line"></i> Osebni podatki</h2>
              <a href="UrediProfil.html" class="edit-link">Uredi <i class="ri-edit-line"></i></a>
            </div>
            <div class="info-grid">
  <div class="info-item">
    <label>Ime</label>
    <p id="user-ime"></p>
  </div>
  <div class="info-item">
    <label>Priimek</label>
    <p id="user-priimek"></p>
  </div>
  <div class="info-item">
    <label>E-naslov</label>
    <p id="user-email"></p>
  </div>
  <div class="info-item">
    <label>Telefon</label>
    <p id="user-telefon"></p>
  </div>

  <div class="info-item">
    <label>Član od</label>
    <p id="user-clanod"></p>
  </div>
</div>
          </section>
          
          <!-- Ride History Section -->
          <section class="profile-section">
            <div class="section-header">
              <h2><i class="ri-history-line"></i> Nedavne vožnje</h2>
              
            </div>
            
             <div class="rides-grid" id="rides-grid"></div> 
          </section>
          
          <!-- Stats Section -->
          <section class="profile-section">
            <div class="section-header">
              <h2><i class="ri-bar-chart-line"></i> Moja statistika</h2>
            </div>
            
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="ri-roadster-line"></i>
                </div>
                <div class="stat-info">
                  <div class="stat-value"></div>
                  <div class="stat-label">Kot voznik</div>
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="ri-user-line"></i>
                </div>
                <div class="stat-info">
                  <div class="stat-value"></div>
                  <div class="stat-label">Kot sopotnik</div>
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="ri-map-pin-line"></i>
                </div>
                <div class="stat-info">
                  <div class="stat-value"></div>
                  <div class="stat-label">Različnih relacij</div>
                </div>
              </div>
              
              
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>
  </section>

 <footer class="footer" id="contact">
  <div class="container">
    <div class="footer-grid">

      <div class="footer-col footer-about">
        <a href="#" class="logo">
          <i class="ri-focus-3-line logo-icon"></i>
          <span class="logo-text">Študentski Prevozi</span>
        </a>
        <p>Študentski Prevozi je vodilna študentska potovalna agencija, ki združuje luksuzna doživetja z ugodnimi cenami za nepozabne dogodivščine sodobnih raziskovalcev.</p>
        <div class="footer-social">
          <a href="#" class="social-link"><i class="ri-instagram-line"></i></a>
          <a href="#" class="social-link"><i class="ri-twitter-x-line"></i></a>
          <a href="#" class="social-link"><i class="ri-facebook-circle-line"></i></a>
          <a href="#" class="social-link"><i class="ri-linkedin-box-line"></i></a>
        </div>
      </div>

      <div class="footer-col footer-links">
        <h4>Podjetje</h4>
        <ul>
           <li><a href="Kontakt.html"><i class="ri-arrow-right-s-line"></i> Kontaktiraj nas</a></li>
          <li><a href="NasaEkipa.html"><i class="ri-arrow-right-s-line"></i> Naša ekipa</a></li>
          <li><a href="Blog.html"><i class="ri-arrow-right-s-line"></i> Blog</a></li>
        </ul>
      </div>

      <div class="footer-col footer-links">
        <h4>Podpora</h4>
        <ul>
          <li><a href="FAQ.html"><i class="ri-arrow-right-s-line"></i> Pogosta vprašanja</a></li>
         
          <li><a href="PolitikaZasebnosti.html"><i class="ri-arrow-right-s-line"></i> Politika zasebnosti</a></li>
          <li><a href="PogojiUporabe.html"><i class="ri-arrow-right-s-line"></i> Pogoji uporabe</a></li>
        </ul>
      </div>

      <div class="footer-col footer-subscribe">
        <h4>Naroči se</h4>
        <p>Naroči se na naš novičnik in bodi obveščen o novih destinacijah ter ekskluzivnih ponudbah.</p>
        <form>
          <input type="email" placeholder="Vnesi svoj e-naslov">
          <button type="submit"><i class="ri-send-plane-line"></i></button>
        </form>
      </div>

    </div></div></footer>
    <div class="back-to-top" id="back-to-top">
    <i class="ri-arrow-up-line"></i>
  </div>

  <!-- Scripts -->
  <script>
    
    // Loader
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('loader').style.opacity = '0';
        setTimeout(() => {
          document.getElementById('loader').style.display = 'none';
        }, 500);
      }, 1000);
    });

    // Mobile Navigation
    const hamburger = document.getElementById('hamburger');
    const navMenu = document.getElementById('nav-menu');
    const overlay = document.getElementById('overlay');
    const navLinks = document.querySelectorAll('.nav-link');

    hamburger.addEventListener('click', () => {
      hamburger.classList.toggle('active');
      navMenu.classList.toggle('active');
      overlay.classList.toggle('active');
      document.body.style.overflow = navMenu.classList.contains('active') ? 'hidden' : 'auto';
    });

    overlay.addEventListener('click', () => {
      hamburger.classList.remove('active');
      navMenu.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = 'auto';
    });

    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        hamburger.classList.remove('active');
        navMenu.classList.remove('active');
        overlay.classList.remove('active');
        document.body.style.overflow = 'auto';
      });
    });

    // Header scroll effect
    const header = document.getElementById('header');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    });

    document.addEventListener('DOMContentLoaded', function() {
  let user = sessionStorage.getItem('user');
  if (!user) return;
  try {
    user = JSON.parse(user);
  } catch {
    return;
  }
 
  if (user.data) user = user.data;

  document.getElementById('user-ime').textContent = user.Ime || '';
  document.getElementById('user-priimek').textContent = user.Priimek || '';
  document.getElementById('user-email').textContent = user.email || user.Eposta || user.Username || '';
  document.getElementById('user-telefon').textContent = user.Telefon || '';
  document.getElementById('user-clanod').textContent =
    user.Datum_registriranja
      ? new Date(user.Datum_registriranja).toLocaleDateString('sl-SI', { month: 'long', year: 'numeric' })
      : '';
});

document.addEventListener('DOMContentLoaded', async function() {
  const ridesGrid = document.getElementById('rides-grid');
  let user = sessionStorage.getItem('user');
  if (!user) {
    ridesGrid.innerHTML = '<p>Uporabnik ni prijavljen.</p>';
    return;
  }
  try {
    user = JSON.parse(user);
  } catch {
    ridesGrid.innerHTML = '<p>Napaka pri branju uporabnika.</p>';
    return;
  }
  // Ispravno: korisnik je u user.data
  if (user.data) user = user.data;

  const avatarImg = document.querySelector('.avatar-image');
  if (avatarImg && user.Slika) {
    avatarImg.src = user.Slika; 
  } else if (avatarImg) {
    avatarImg.src = 'img/default-avatar.png'; // fallback slika ako nema
  }

  const userId = user.idUporabnik;
  if (!userId) {
    ridesGrid.innerHTML = '<p>Uporabniški ID ni najden.</p>';
    return;
  }

  ridesGrid.innerHTML = '<p>Nalaganje voženj...</p>';
  try {
    const res = await fetch(`http://localhost:3000/api/zgodovina/uporabnik/${userId}`);
    const json = await res.json();
    if (json.success && Array.isArray(json.data) && json.data.length > 0) {
      ridesGrid.innerHTML = json.data.map(ride => {
        const dateObj = new Date(ride.Cas_odhoda);
        const dateStr = dateObj.toLocaleDateString('sl-SI', { day: '2-digit', month: 'short', year: 'numeric' });
        const timeStr = dateObj.toLocaleTimeString('sl-SI', { hour: '2-digit', minute: '2-digit' });
        let statusClass = '';
        if (ride.Status === 'Preklicano' || ride.Status === 'Preklican') statusClass = 'cancelled';
        else if (ride.Status === 'Zaključeno' || ride.Status === 'Izveden') statusClass = 'completed';
        else statusClass = 'pending';
        const roleIcon = ride.Vloga === 'Voznik'
          ? '<i class="ri-steering-line"></i>'
          : '<i class="ri-user-line"></i>';
        const rating = ride.Ocena !== null && ride.Ocena !== undefined ? ride.Ocena : '-';
        return `
          <div class="ride-card">
            <div class="ride-header">
              <div class="ride-date">${dateStr}</div>
              <div class="ride-status ${statusClass}">${ride.Status}</div>
            </div>
            <div class="ride-route">
              <div class="route-point">
                <div class="point-marker start"></div>
                <div class="point-details">
                  <div class="point-city">${ride.Odhod}</div>
                  <div class="point-time">${timeStr}</div>
                </div>
              </div>
              <div class="route-line"></div>
              <div class="route-point">
                <div class="point-marker end"></div>
                <div class="point-details">
                  <div class="point-city">${ride.Prihod}</div>
                </div>
              </div>
            </div>
            <div class="ride-footer">
              <div class="ride-role">
                ${roleIcon}
                <span>${ride.Vloga}</span>
              </div>
              <div class="ride-rating">
                <i class="ri-star-fill"></i>
                <span>${rating}</span>
              </div>
              
            </div>
          </div>
        `;
      }).join('');
    } else {
      ridesGrid.innerHTML = '<p>Ni voženj za prikaz.</p>';
    }
  } catch (err) {
    ridesGrid.innerHTML = '<p>Napaka pri nalaganju voženj.</p>';
  }
});

    // Back to top button
    const backToTop = document.getElementById('back-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        backToTop.classList.add('active');
      } else {
        backToTop.classList.remove('active');
      }
    });

    backToTop.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    document.addEventListener('DOMContentLoaded', function() {
  let user = sessionStorage.getItem('user');
  if (!user) return;
  try {
    user = JSON.parse(user);
  } catch {
    return;
  }
  if (user.data) user = user.data;

  // Sidebar podaci
  const sidebarIme = document.getElementById('sidebar-imepriimek');
  const sidebarEmail = document.getElementById('sidebar-email');
  const sidebarUniverza = document.getElementById('sidebar-univerza');
  if (sidebarIme) sidebarIme.textContent = (user.Ime || '') + ' ' + (user.Priimek || '');
  if (sidebarEmail) sidebarEmail.textContent = user.email || user.Eposta || user.Username || '';
  if (sidebarUniverza) sidebarUniverza.textContent = user.Univerza || '';
});


document.addEventListener('DOMContentLoaded', async function() {
    let user = sessionStorage.getItem('user');
    if (!user) return;
    try { user = JSON.parse(user); } catch { return; }
    if (user.data) user = user.data;
    const userId = user.idUporabnik;
    if (!userId) return;

    // Statistika API poziv
    try {
      const res = await fetch(`http://localhost:3000/api/stats/uporabnik/${userId}`);
      const json = await res.json();
      if (!json.success || !json.data) return;

      // Sidebar statistika
      const sidebarStats = document.querySelectorAll('.profile-stats .stat-item');
      if (sidebarStats.length >= 3) {
        sidebarStats[0].querySelector('.stat-value').textContent = 
          (json.data.asDriver + json.data.asPassenger) || 0; // Ukupno vožnji
        sidebarStats[1].querySelector('.stat-value').textContent = 
          json.data.avgRating !== null ? Number(json.data.avgRating).toFixed(1) : '-'; // Ocena
        sidebarStats[2].querySelector('.stat-value').textContent = 
          json.data.relations || 0; // Različnih relacija (možeš promeniti labelu ako želiš)
      }

      // Glavna statistika
      const statCards = document.querySelectorAll('.stats-grid .stat-card');
      if (statCards.length >= 4) {
        statCards[0].querySelector('.stat-value').textContent = json.data.asDriver || 0; // Kao vozač
        statCards[1].querySelector('.stat-value').textContent = json.data.asPassenger || 0; // Kao putnik
        statCards[2].querySelector('.stat-value').textContent = json.data.relations || 0; // Različnih relacija
        // statCards[3] je CO2, ostavi statički ili izračunaj po želji
      }
    } catch (e) {
      // Možeš prikazati grešku ako želiš
    }
  });

  // ...existing code...
document.addEventListener('DOMContentLoaded', function() {
  const logoutBtn = document.querySelector('.btn-logout');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', function(e) {
      sessionStorage.clear();
      // Nema potrebe za preventDefault jer vodi na Login.html
      // Ako želiš AJAX logout, možeš dodati e.preventDefault();
    });
  }
});

// ...existing code...
document.addEventListener('DOMContentLoaded', async function() {
    let user = sessionStorage.getItem('user');
    if (!user) return;
    try { user = JSON.parse(user); } catch { return; }
    if (user.data) user = user.data;
    const userId = user.idUporabnik;
    if (!userId) return;

    // Statistika API poziv
    try {
      const res = await fetch(`http://localhost:3000/api/stats/uporabnik/${userId}`);
      const json = await res.json();
      if (!json.success || !json.data) return;

      // Sidebar statistika
      const sidebarStats = document.querySelectorAll('.profile-stats .stat-item');
      if (sidebarStats.length >= 3) {
        sidebarStats[0].querySelector('.stat-value').textContent = 
          (json.data.asDriver + json.data.asPassenger) || 0; // Ukupno vožnji
        sidebarStats[1].querySelector('.stat-value').textContent = 
          json.data.avgRating !== null ? Number(json.data.avgRating).toFixed(1) : '-'; // Ocena
        sidebarStats[2].querySelector('.stat-value').textContent = 
          json.data.asPassenger || 0; // Broj kao putnik (ili promeni labelu po želji)
      }

      // Glavna statistika
      const statCards = document.querySelectorAll('.stats-grid .stat-card');
      if (statCards.length >= 3) {
        statCards[0].querySelector('.stat-value').textContent = json.data.asDriver || 0; // Kao vozač
        statCards[1].querySelector('.stat-value').textContent = json.data.asPassenger || 0; // Kao putnik
        statCards[2].querySelector('.stat-value').textContent = json.data.relations || 0; // Različnih relacija
      }
    } catch (e) {
      // Možeš prikazati grešku ako želiš
    }
});
// ...existing code...
// ...existing code...
</script>
</body>
</html>